<html>
    <head>
        <script type="text/javascript" src="/webgl/matrix.js"></script>
        <script type="text/javascript" src="/webgl/glUtils.js"></script>
        <script type="text/javascript" src="/webgl/VertexRenderer.js"></script>
        <script type="text/javascript" src="./SeatmapView.js"></script>

        <script>
            async function SeatmapCreate() {
                const res = await fetch('/v2/seatmap')
                const seatmap = await res.json()

                const canvas = document.getElementById('glcanvas')

                const seatmapView = new SeatmapView()
                seatmapView.Initialize(seatmap, canvas)

                const reload = async () => {
                    const res = await fetch('/v2/status')
                    const base64Statuses = await res.json()

                    const holds = Uint8Array.from(atob(base64Statuses.holds), (c) => c.charCodeAt(0))
                    const solds = Uint8Array.from(atob(base64Statuses.solds), (c) => c.charCodeAt(0))

                    seatmapView.Draw(holds, solds)

                    setTimeout(reload, 1000)
                }

                reload()
            }
        </script>
    </head>
    <body onload="SeatmapCreate()">
        <!-- width,height를 <style>안에서 지정하면 webgl에서 제대로 인식하지 않음 -->
        <canvas id="glcanvas" width="600" height="600"></canvas>
    </body>
</html>
